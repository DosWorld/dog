
<html>
<head>
<title>../../SRC/MV.C</title>
<meta name="generator" content="c2html 0.9.2">
<meta name="date" content="2000-10-20T10:17:31+00:00">
</head>

<body bgcolor="#FFFFFF">
<?php
    $title="DOG - Developer - Source";
  include("../include/head.php");
?>
  
<!-- Left side -->
  
<?php include("../include/dleft.htmlf"); ?>
  
<!-- Right side -->
<TD>
<pre width="80"><font color="#B22222">/*

MV.C - DOG - Alternate command processor for (currently) MS-DOS ver 3.30

Copyright (C) 1999,2000 Wolf Bergenheim

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.

Developers:
Wolf Bergenheim (WB)

TODO: Wildcard recognition (*.*, etc)

History
18.03.00 - Extracted from DOG.C - WB
20.10.00 - Renamed nn to mv (It should havee been named mv from the beginning)
           Fixed do_mv. - WB

**************************************************************************/</font>

<strong><font color="#4169E1">WORD newname(BYTE *oldname, BYTE *newname)</font></strong>;

<strong><font color="#4169E1"><a name="do_mv"></a>void do_mv(BYTE n)</font></strong>
{
    BYTE *p, b, ndir[129], odir[129], nn[129]={0},on[129]={0},tn[12]={0}; 
<font color="#A020F0">#ifdef MV_WILD</font>
    BYTE fn[129]={0}, wild=0;
<font color="#A020F0">#endif</font>
    WORD r;
    <font color="#4169E1">struct ffblk</font> ffb,*fb=&amp;ffb;

    <font color="#4169E1">if</font>(n != 3) {
        puts(<font color="#666666">"Invalid number of arguments."</font>);
        <font color="#4169E1">return</font>;
    }
    
    b = findfirst(arg[1],fb,0);

    <font color="#4169E1">while</font> (b != 18) {
    
        strcpy(odir,arg[1]); 
        p = odir;
        
        <font color="#B22222">/* separate path from filename */</font>
        <font color="#4169E1">for</font>(p+=strlen(odir)+1;(*p!='\\') &amp;&amp; (p &gt; odir);p--);
        <font color="#4169E1">if</font> (p&gt;odir) {
            *(++p) = '\0';
        }
        <font color="#4169E1">else</font>
            strcpy(odir,<font color="#666666">""</font>);

        strcpy(ndir,arg[2]); 
        p = ndir;
        
        <font color="#B22222">/* separate path from filename */</font>
        <font color="#4169E1">for</font>(p+=strlen(ndir)+1;(*p!='\\') &amp;&amp; (p &gt; ndir);p--);
        strcpy(tn,p+1);
        <font color="#4169E1">if</font> (p&gt;ndir) {
            *(++p) = '\0';
        }
        <font color="#4169E1">else</font>
            strcpy(ndir,<font color="#666666">""</font>);

<font color="#A020F0">#ifdef debug_mv</font>
printf(<font color="#666666">"odir = /%s/ ndir = /%s/\n"</font>,odir,ndir);
<font color="#A020F0">#endif</font>
        
<font color="#A020F0">#ifdef MV_WILD</font>
        <font color="#4169E1">if</font>(wild == 1) {
            <font color="#4169E1">if</font>(trueName(nn,arg[2]) == NULL) {
                printf(<font color="#666666">"Malformed path:\n%s\n"</font>,arg[2]);
                <font color="#B22222">/* break */</font>
            }
                
            <font color="#4169E1">if</font>(trueName(on,fn) == NULL) {
                printf(<font color="#666666">"Malformed path:\n%s\n"</font>,arg[1]);
                <font color="#B22222">/* break */</font>
            }
            
            <font color="#4169E1">for</font>(b=0;nn[b] != '\0';b++) {
                <font color="#4169E1">if</font>(nn[b] == '?')
                    nn[b]=on[b];
            }
        }
<font color="#A020F0">#else</font>
        strcpy(on,odir);
        strcat(on,fb-&gt;ff_name);
        strcpy(nn,ndir);
        strcat(nn,tn);
<font color="#A020F0">#endif</font>
        printf(<font color="#666666">"%s --&gt; %s\n"</font>,on,nn);
        r = newname(on,nn);
    
        <font color="#4169E1">if</font>(r != 0) {
            <font color="#4169E1">switch</font>(r) {
                <font color="#4169E1">case</font> 02:
                    printf(<font color="#666666">"%s NOT found.\n"</font>,on);
                    <font color="#4169E1">break</font>;
                <font color="#4169E1">case</font> 03: 
                    puts(<font color="#666666">"Path not found."</font>);
                    <font color="#4169E1">break</font>;
                <font color="#4169E1">case</font> 05: 
                    puts(<font color="#666666">"Access denied."</font>);
                    <font color="#4169E1">break</font>;
                <font color="#4169E1">case</font> 11: 
                    puts(<font color="#666666">"Invalid format."</font>);
                    <font color="#4169E1">break</font>;
            }
        }
    
        b = findnext(fb);
    }
    <font color="#4169E1">return</font>;

}

<font color="#B22222">/**************************************************************************/</font>

<strong><font color="#4169E1"><a name="newname"></a>WORD newname(BYTE *oldname, BYTE *newname)</font></strong>
{
    WORD r;
    asm{
        mov ah,56h
        push cs
        pop es
        mov dx,oldname
        mov di,newname
        int 21h
        jnc  nn_ok
        mov r,ax
    }
    <font color="#4169E1">return</font> r;
<strong><font color="#FF0000">    nn_ok:</font></strong>
    <font color="#4169E1">return</font> 0;
}

<font color="#B22222">/****************************************************************************/</font>

<strong><font color="#4169E1"><a name="trueName"></a>BYTE *trueName(BYTE *name,BYTE *tn)</font></strong>
{
    asm{
        push ds
        pop es
        mov si,name
        mov di,tn
        mov ah,60h
        int 21h
        jnc tn_ok
    }
    <font color="#4169E1">return</font> NULL;
<strong><font color="#FF0000">    tn_ok:</font></strong>
    <font color="#4169E1">return</font> tn;

}


</pre>


<!-- END of Table-->
</TD></tr></table>


</body>
</html>
</body>

</html>
