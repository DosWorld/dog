<?php
    $title="DOG - Developer - Source";
  include("../include/head.php");
?>
  
<!-- Left side -->
  
<?php include("../include/src_left.htmlf"); ?>
  
<!-- Right side -->
<TD>
<pre width="80"><font color="#B22222">/*

SZ.C - DOG - Alternate command processor for (currently) MS-DOS ver 3.30

Copyright (C) 1999,2000 Wolf Bergenheim

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.

Developers:
Wolf Bergenheim (WB)

History
18.03.00 - Extracted from DOG.C - WB

**************************************************************************/</font>

<strong><font color="#4169E1"><a name="do_sz"></a>void do_sz(BYTE n)</font></strong>
{
    <font color="#4169E1">struct ffblk</font> *fb;
    BYTE b,i,j,str[5];
    WORD max,mbx,mcx,mdx;
    DWORD h,s,d,t;

    <font color="#4169E1">if</font> (n &gt; 2) {
        puts(<font color="#666666">"Invalid number of arguments."</font>);
        <font color="#4169E1">return</font>;
    }
    str [0] = '\0';

    i=0; j=0;
    s=0; d=0;
    h=0;

    fb = malloc(<font color="#4169E1">sizeof</font>(<font color="#4169E1">struct ffblk</font>));

    asm{
        mov AH,36h
        xor dl,dl
        int 21h
        mov max,AX
        mov mbx,BX
        mov mcx,CX
        MOV mdx,DX
    }

    d = (DWORD)max*(DWORD)mbx*(DWORD)mdx; 
    t = (DWORD)max*(DWORD)mcx*(DWORD)mdx;

    b = findfirst(<font color="#666666">"*.*"</font>,fb,FA_NORMAL|FA_HIDDEN|FA_SYSTEM);
    <font color="#4169E1">if</font> (b!=18) {
        <font color="#4169E1">if</font> (((fb-&gt;ff_attrib &amp; FA_HIDDEN) == FA_HIDDEN)){
            h += fb-&gt;ff_fsize;
            j++;
        }
        <font color="#4169E1">else</font> <font color="#4169E1">if</font> (((fb-&gt;ff_attrib &amp; FA_SYSTEM) == FA_SYSTEM)){
            h += fb-&gt;ff_fsize;
            j++;
        }

        <font color="#4169E1">else</font> {
            s += fb-&gt;ff_fsize;
            i++;
        }
    }
    b = findnext(fb);
    <font color="#4169E1">while</font> (b!=18) {
        <font color="#4169E1">if</font>(cBreak) {
            cBreak = 0;
            <font color="#4169E1">return</font>;
        }
        <font color="#4169E1">if</font> (((fb-&gt;ff_attrib &amp; FA_HIDDEN) == FA_HIDDEN)) {
            h += fb-&gt;ff_fsize;
            j++;
        }

        <font color="#4169E1">else</font> <font color="#4169E1">if</font> (((fb-&gt;ff_attrib &amp; FA_SYSTEM) == FA_SYSTEM)){
            h += fb-&gt;ff_fsize;
            j++;
        }

        <font color="#4169E1">else</font> {
            s += fb-&gt;ff_fsize;
            i++;
        }
        b = findnext(fb);
    }

    <font color="#4169E1">if</font> (strnicmp(arg[1],<font color="#666666">"-k"</font>,2)==0) {
        h /= 1024;
        s /= 1024;
        d /= 1024;
        t /= 1024;
        strcpy(str,<font color="#666666">"kilo"</font>);
    }

    <font color="#4169E1">if</font> (strnicmp(arg[1],<font color="#666666">"-m"</font>,2)==0) {
        h /= 10264576;
        s /= 10264576;
        d /= 10264576;
        t /= 10264576;
        strcpy(str,<font color="#666666">"mega"</font>);
    }

    printf(<font color="#666666">"\n%11lu %sbytes in %d file(s)\n%11lu %sbytes in %d hidden file(s)\n"</font>,s,str,i,h,str,j);
    printf(<font color="#666666">"%11lu %sbytes free on drive %c:\n%11lu %sbytes total diskspace\n"</font>,d,str,D,t,str);
    free(fb);
    <font color="#4169E1">return</font>;
}

</pre>


<!-- END of Table-->
</TD></tr></table>


</body>
</html>
